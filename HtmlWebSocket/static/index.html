<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实时备忘录</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="bg-indigo-600 p-6">
                <h1 class="text-2xl font-bold text-white flex items-center">
                    <i class="fas fa-sticky-note mr-3"></i>实时备忘录
                </h1>
            </div>

            <div class="p-6">
                <div class="mb-6 bg-gray-50 rounded-lg p-4 max-h-96 overflow-y-auto">
                    <ul id="memoList" class="space-y-3"></ul>
                    <div id="emptyState" class="text-center py-8 text-gray-500">
                        <i class="fas fa-clipboard-list text-4xl mb-3"></i>
                        <p>暂无备忘录</p>
                    </div>
                </div>

                <div class="flex items-center space-x-2">
                    <div class="flex-1">
                        <input id="memoInput" placeholder="请输入备忘内容..."
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <button onclick="addMemo()"
                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-lg transition duration-200 flex items-center">
                        <i class="fas fa-plus mr-2"></i>添加
                    </button>
                    <button onclick="clearMemos()"
                        class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-3 rounded-lg transition duration-200 flex items-center">
                        <i class="fas fa-trash-alt mr-2"></i>清空
                    </button>
                </div>
            </div>
        </div>

        <div id="notification"
            class="fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300">
            操作成功
        </div>
    </div>

    <script>
       const ws = new WebSocket("ws://localhost:8000/ws/memos");
        const memoList = document.getElementById("memoList");
        const emptyState = document.getElementById("emptyState");
        const notification = document.getElementById("notification");

        function showNotification(message) {
            notification.textContent = message;
            notification.classList.remove("translate-y-20", "opacity-0");
            notification.classList.add("translate-y-0", "opacity-100");

            setTimeout(() => {
                notification.classList.remove("translate-y-0", "opacity-100");
                notification.classList.add("translate-y-20", "opacity-0");
            }, 3000);
        }

        ws.onmessage = event => {
            const memos = JSON.parse(event.data);
            memoList.innerHTML = "";

            if (memos.length === 0) {
                emptyState.classList.remove("hidden");
            } else {
                emptyState.classList.add("hidden");

                memos.forEach(m => {
                    const li = document.createElement("li");
                    li.className = "bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition duration-200";

                    const time = new Date(m.time);
                    const formattedTime = `${time.getFullYear()}-${(time.getMonth() + 1).toString().padStart(2, '0')}-${time.getDate().toString().padStart(2, '0')} ${time.getHours().toString().padStart(2, '0')}:${time.getMinutes().toString().padStart(2, '0')}`;

                    li.innerHTML = `
                        <div class="flex justify-between items-start">
                            <p class="text-gray-800">${m.content}</p>
                            <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full">${formattedTime}</span>
                        </div>
                    `;
                    memoList.appendChild(li);
                });
            }
        };

        function addMemo() {
            const content = document.getElementById("memoInput").value.trim();
            if (content) {
                fetch("/memo/add", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ content })
                })
                    .then(() => {
                        document.getElementById("memoInput").value = "";
                        showNotification("备忘录已添加");
                    });
            } else {
                showNotification("请输入备忘内容");
            }
        }


        function clearMemos() {
            if (confirm("确定要清空所有备忘录吗？")) {
                fetch("/memo/clear", { method: "POST" })
                    .then(() => {
                        showNotification("所有备忘录已清空");
                    });
            }
        }

        // 按Enter键添加备忘
        document.getElementById("memoInput").addEventListener("keypress", function (e) {
            if (e.key === "Enter") {
                addMemo();
            }
        });
    </script>
</body>

</html>